<!DOCTYPE html>
<html ng-app='myApp'>
    <head>
        <link rel="stylesheet" href="css/bootstrap.css">
        <link rel="stylesheet" href="css/app.css">
        <script type="text/javascript" src="angular.min.js"></script>
        <script type="text/javascript" src="bootstrap.min.js"></script>
<!--        
        <style type="text/css">
            .even{
                color:red;
            }
            
            .odd{
                color:blue;
            }
        </style>
-->

    </head>
    
    <body style="padding: 50px">
        
        <!--<div ng-init="albumNames = ['Madrid', 'Iceland', 'Thailand', 'Australia']">-->

<!--        
        <div ng-init="albums = [
        {name: 'Madrid', title: 'Weekend in Madrid', date: '2013-09-01', description: 'Yay Madrid'},
        {name: 'Iceland', title: 'Weekend in Iceland', date: '2014-09-02', description: 'Yay Iceland'},
        {name: 'Thailand', title: 'Weekend in Thailand', date: '2015-09-03', description: 'Yay Thailand'},
        {name: 'Australia', title: 'Weekend in Australia', date: '2016-09-01', description: 'Yay Australia'}
        ]">
-->

        <div ng-controller="AlbumListController">

            <p>
                <!--Search for--> <input type='text' placeholder="Type to search..." ng-model='searchFor' size='30'>  <!--{{searchFor}}-->
            </p>
            
            <p>
                There are {{albums.length}} albums to view.
            </p>

<!--
            <ul>
                <li ng-repeat= "album in albums | filter:'thailand'">
                <li ng-repeat= "album in albums | filter:searchFor | orderBy:'date'">
                <li ng-repeat= "album in albums | filter:searchFor | orderBy:'date'" ng-class="{even: $even, odd: $odd}">
                <li ng-repeat= "album in albums | filter:searchFor | orderBy:'date'" ng-class-even="'even'" ng-class-odd="'odd'">
                    {{$index + 1}} - {{album.title | uppercase}} ({{album.date}})
                </li>
            </ul>
-->    

<!--
            <div class="panel panel-primary" ng-repeat= "album in albums | filter:searchFor | orderBy:'date'"
                style="
                float:left; 
                width:300px;
                margin-right:10px;
                min-height: 200px;
                "
            >
-->        
            <!--<div class="album panel panel-primary" ng-repeat= "album in albums | filter:searchFor | orderBy:'date'">-->
            <div class="album panel panel-primary" ng-repeat= "album in albums | filter:{title: searchFor} | orderBy:'date'">
                <div class="panel-heading">
                    <div style="float:right">({{album.date}})</div>
                    {{album.title | uppercase}} 
                </div>
                
                <!--<div style="padding:5px">-->
                <div class="description">
                    {{album.description}}
                </div>
                
            </div>
        
<!--            
            <hr/>
    
            <p>
                There are {{albums.length}} album objects to enumerate.
            </p>
            
            <ul>
                <li ng-repeat='album in albums'>
                    <ul>
                        <li ng-repeat="(key, value) in album">
                            <strong>{{ key}}</strong> = {{value}}
                        </li>
                        <br/>
                    </ul>
                </li>
            </ul>
-->

            <div style:"clear: left"></div>

            <h3>Add New Album</h3>
            <div class="album panel panel-default">
                <form name="add_album_form" novalidate>
                    <div class="panel-heading">
                        <div class="alert alert-danger" ng-show="add_album_error">{{add_album_error}}</div>
                        <input type="text" placeholder="Title..." size="20" ng-model="adding_album.title"/>
                        
                        <div style="float:right">
                            <!--<input name="date" ng-required="true" ng-minlength="10" type="text" placeholder="yyyy/mm/dd" size="10" ng-model="adding_album.date"/>-->
                            <input name="date" ng-required="true" ng-minlength="10" type="text" placeholder="yyyy/mm/dd" size="10" ng-model="adding_album.date"/>
                        </div>
                    
                    </div>
                    
                    <div class="description">
                        <p>
                            <textarea ng-model="adding_album.description" placeholder="Description..." rows="4" style="width:100%"/></textarea>
                        </p>
                        
                        <p>
                            <input type="text" ng-model="adding_album.name" placeholder="Name..." style="width:100%"/>
                        </p>
                        
                        
                        <p>
                            <button ng-click="addAlbum(adding_album)" type="button" class= "btn btn-success">Add New Album</button>
                        </p>
                    </div>
                </form>
            </div>

<script type="text/javascript">

//This is hacky, and I don't quite understand it.  I think it registers the app as a module and then adds 
//  the controller to it, but I'm not sure.  Found this in the Youtube comments, because the original version
//  based on the tutorial doesn't work without it for some reason.  Might be a depricated thing from a past version
//  of angular.
    var myApp = angular.module('myApp', [])  .controller('AlbumListController', AlbumListController);
//
    function AlbumListController ($scope) {
        $scope.adding_album = {};
        $scope.add_album_error="";
        $scope.albums = [
        {name: 'Madrid', title: 'Weekend in Madrid', date: '2013-09-01', description: 'Yay Madrid'},
        {name: 'Iceland', title: 'Weekend in Iceland', date: '2014-09-02', description: 'Yay Iceland'},
        {name: 'Thailand', title: 'Weekend in Thailand', date: '2015-09-03', description: 'Yay Thailand'},
        {name: 'Australia', title: 'Weekend in Australia', date: '2016-09-01', description: 'Yay Australia'}
        ];
        
        $scope.addAlbum = function (new_album){
            //validation
            
            if (!new_album.title)
                $scope.add_album_error = "Missing title";
            else if (!new_album.date || !is_valid_date(new_album.date))
                $scope.add_album_error = "Date not correct"
            else if (!new_album.description)
                $scope.add_album_error = "Missing description"
            else if (!new_album.name)
                $scope.add_album_error = "Missing short name"
            else{
                $scope.albums.push(new_album);
                $scope.adding_album={};
                $scope.add_album_error="";
            }
        }
    }
    
    //This doesn't work at all.  If it came down to it, I would use a library for validation.
    //  super, SUPER, S*U*P*E*R* annoying compared to Ruby.  why the heck isn't there a flexible datetime type?!
    //
    //function is_valid_date(the_date) {
    //    if (the_date.match(/^[0-9]{2,4}\/[0-9]{1,2}\/[0-9]{1,2}^/))
    //        return true;
    //    return false;
    //}
    
</script>

        </div>
    </body>
</html>